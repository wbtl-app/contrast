<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrast Checker - wbtl.app</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%235b9bd5'/><stop offset='100%25' stop-color='%234a89c4'/></linearGradient></defs><rect width='32' height='32' rx='6' fill='url(%23g)'/><circle cx='16' cy='16' r='10' stroke='white' stroke-width='2' fill='none'/><path d='M16 6a10 10 0 0 1 0 20' fill='white'/></svg>">
  <style>
    :root {
      --bg: #ffffff;
      --bg-secondary: #f5f5f7;
      --text: #1d1d1f;
      --text-secondary: #6e6e73;
      --accent: #0071e3;
      --accent-hover: #0077ed;
      --border: #d2d2d7;
      --toggle-bg: #e5e5e5;
      --toggle-knob: #ffffff;
      --success: #34c759;
      --success-bg: #d1f5d9;
      --error: #ff3b30;
      --error-bg: #ffe5e5;
      --tool-gradient-start: #5b9bd5;
      --tool-gradient-end: #4a89c4;
    }

    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --bg: #000000;
        --bg-secondary: #1c1c1e;
        --text: #f5f5f7;
        --text-secondary: #98989d;
        --accent: #2997ff;
        --accent-hover: #40a9ff;
        --border: #38383a;
        --toggle-bg: #3a3a3c;
        --toggle-knob: #ffffff;
        --success: #30d158;
        --success-bg: #0d3d1a;
        --error: #ff453a;
        --error-bg: #3d1515;
      }
    }

    [data-theme="dark"] {
      --bg: #000000;
      --bg-secondary: #1c1c1e;
      --text: #f5f5f7;
      --text-secondary: #98989d;
      --accent: #2997ff;
      --accent-hover: #40a9ff;
      --border: #38383a;
      --toggle-bg: #3a3a3c;
      --toggle-knob: #ffffff;
      --success: #30d158;
      --success-bg: #0d3d1a;
      --error: #ff453a;
      --error-bg: #3d1515;
    }

    [data-theme="light"] {
      --bg: #ffffff;
      --bg-secondary: #f5f5f7;
      --text: #1d1d1f;
      --text-secondary: #6e6e73;
      --accent: #0071e3;
      --accent-hover: #0077ed;
      --border: #d2d2d7;
      --toggle-bg: #e5e5e5;
      --toggle-knob: #ffffff;
      --success: #34c759;
      --success-bg: #d1f5d9;
      --error: #ff3b30;
      --error-bg: #ffe5e5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .tool-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--tool-gradient-start), var(--tool-gradient-end));
    }

    .tool-icon svg {
      width: 24px;
      height: 24px;
    }

    .tool-name {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .back-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s ease;
    }

    .back-link:hover {
      color: var(--accent);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .theme-toggle svg {
      width: 16px;
      height: 16px;
      stroke: var(--text-secondary);
      fill: none;
      stroke-width: 2;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: var(--toggle-bg);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: var(--toggle-knob);
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
    }

    [data-theme="dark"] .toggle-switch::after,
    :root:not([data-theme="light"]) .toggle-switch::after {
      transform: translateX(20px);
    }

    @media (prefers-color-scheme: light) {
      :root:not([data-theme="dark"]) .toggle-switch::after {
        transform: translateX(0);
      }
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    .content {
      width: 100%;
    }

    /* Color Inputs Section */
    .color-inputs {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 1rem;
      align-items: end;
      margin-bottom: 2rem;
    }

    .color-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .color-input-group label {
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .color-input-wrapper {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .color-picker {
      width: 50px;
      height: 50px;
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      padding: 0;
      overflow: hidden;
    }

    .color-picker::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .color-picker::-webkit-color-swatch {
      border: none;
      border-radius: 8px;
    }

    .color-picker::-moz-color-swatch {
      border: none;
      border-radius: 8px;
    }

    .color-text-input {
      flex: 1;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--bg);
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      transition: border-color 0.2s ease;
    }

    .color-text-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .swap-button {
      width: 50px;
      height: 50px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--bg-secondary);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .swap-button:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .swap-button svg {
      width: 24px;
      height: 24px;
    }

    /* Preview Section */
    .preview-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .main-preview {
      padding: 2rem;
      border-radius: 16px;
      border: 2px solid var(--border);
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .preview-large-text {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .preview-normal-text {
      font-size: 16px;
      margin-bottom: 1rem;
    }

    .preview-small-text {
      font-size: 14px;
    }

    /* Ratio Display */
    .ratio-display {
      text-align: center;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 2px solid var(--border);
    }

    .ratio-value {
      font-size: 3rem;
      font-weight: 700;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
    }

    .ratio-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    /* WCAG Compliance Grid */
    .wcag-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .wcag-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 2px solid var(--border);
    }

    .wcag-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .wcag-badge.pass {
      background: var(--success-bg);
      color: var(--success);
    }

    .wcag-badge.fail {
      background: var(--error-bg);
      color: var(--error);
    }

    .wcag-badge svg {
      width: 16px;
      height: 16px;
    }

    .wcag-info {
      flex: 1;
    }

    .wcag-level {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .wcag-description {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Suggestions Panel */
    .suggestions-panel {
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 2px solid var(--border);
      margin-bottom: 2rem;
      display: none;
    }

    .suggestions-panel.visible {
      display: block;
    }

    .suggestions-title {
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .suggestions-title svg {
      width: 20px;
      height: 20px;
      color: var(--accent);
    }

    .suggestion-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .suggestion-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .suggestion-item:hover {
      border-color: var(--accent);
    }

    .suggestion-swatch {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .suggestion-text {
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 0.85rem;
    }

    .suggestion-ratio {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* UI Component Preview */
    .component-preview {
      padding: 1.5rem;
      border-radius: 16px;
      border: 2px solid var(--border);
      margin-bottom: 2rem;
    }

    .component-preview h3 {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .component-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }

    .preview-button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
    }

    .preview-link {
      font-size: 1rem;
      text-decoration: underline;
      cursor: pointer;
    }

    .preview-input {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      border: 2px solid;
      width: 150px;
    }

    /* Recent Colors */
    .recent-colors {
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 2px solid var(--border);
    }

    .recent-title {
      font-weight: 600;
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }

    .recent-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .recent-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.375rem 0.75rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }

    .recent-item:hover {
      border-color: var(--accent);
    }

    .recent-swatch {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .recent-empty {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .color-inputs {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .swap-button {
        width: 100%;
        transform: rotate(90deg);
      }

      .preview-section {
        grid-template-columns: 1fr;
      }

      .wcag-grid {
        grid-template-columns: 1fr;
      }

      .tool-name {
        font-size: 1.1rem;
      }

      .header-right {
        gap: 1rem;
      }

      .back-link {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <div class="tool-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 2a10 10 0 0 1 0 20" fill="white" stroke="none"/>
        </svg>
      </div>
      <div class="tool-name">Contrast Checker</div>
    </div>
    <div class="header-right">
      <a href="https://wbtl.app" class="back-link">wbtl.app</a>
      <div class="theme-toggle">
        <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <div class="toggle-switch" onclick="toggleTheme()" role="button" tabindex="0" aria-label="Toggle dark mode"></div>
        <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </div>
    </div>
  </header>

  <main>
    <div class="content">
      <!-- Color Inputs -->
      <div class="color-inputs">
        <div class="color-input-group">
          <label for="foreground">Foreground (Text)</label>
          <div class="color-input-wrapper">
            <input type="color" id="fg-picker" class="color-picker" value="#000000">
            <input type="text" id="foreground" class="color-text-input" value="#000000" placeholder="#000000">
          </div>
        </div>

        <button class="swap-button" onclick="swapColors()" aria-label="Swap colors">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M7 16l-4-4 4-4"/>
            <path d="M17 8l4 4-4 4"/>
            <path d="M3 12h18"/>
          </svg>
        </button>

        <div class="color-input-group">
          <label for="background">Background</label>
          <div class="color-input-wrapper">
            <input type="color" id="bg-picker" class="color-picker" value="#ffffff">
            <input type="text" id="background" class="color-text-input" value="#FFFFFF" placeholder="#FFFFFF">
          </div>
        </div>
      </div>

      <!-- Preview and Ratio -->
      <div class="preview-section">
        <div class="main-preview" id="main-preview">
          <div class="preview-large-text">Large Text (24px+)</div>
          <div class="preview-normal-text">Normal text appears like this (16px)</div>
          <div class="preview-small-text">Small text for details (14px)</div>
        </div>

        <div class="ratio-display">
          <div class="ratio-value" id="ratio-value">21:1</div>
          <div class="ratio-label">Contrast Ratio</div>
        </div>
      </div>

      <!-- WCAG Compliance Grid -->
      <div class="wcag-grid">
        <div class="wcag-item">
          <div class="wcag-badge pass" id="aa-normal-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Pass
          </div>
          <div class="wcag-info">
            <div class="wcag-level">WCAG AA - Normal Text</div>
            <div class="wcag-description">Minimum 4.5:1 ratio required</div>
          </div>
        </div>

        <div class="wcag-item">
          <div class="wcag-badge pass" id="aa-large-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Pass
          </div>
          <div class="wcag-info">
            <div class="wcag-level">WCAG AA - Large Text</div>
            <div class="wcag-description">Minimum 3:1 ratio required</div>
          </div>
        </div>

        <div class="wcag-item">
          <div class="wcag-badge pass" id="aaa-normal-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Pass
          </div>
          <div class="wcag-info">
            <div class="wcag-level">WCAG AAA - Normal Text</div>
            <div class="wcag-description">Minimum 7:1 ratio required</div>
          </div>
        </div>

        <div class="wcag-item">
          <div class="wcag-badge pass" id="aaa-large-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Pass
          </div>
          <div class="wcag-info">
            <div class="wcag-level">WCAG AAA - Large Text</div>
            <div class="wcag-description">Minimum 4.5:1 ratio required</div>
          </div>
        </div>
      </div>

      <!-- Suggestions Panel -->
      <div class="suggestions-panel" id="suggestions-panel">
        <div class="suggestions-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4"/>
            <path d="M12 8h.01"/>
          </svg>
          Suggested Alternatives for WCAG AA Compliance
        </div>
        <div class="suggestion-list" id="suggestion-list"></div>
      </div>

      <!-- UI Component Preview -->
      <div class="component-preview" id="component-preview">
        <h3>UI Component Preview</h3>
        <div class="component-grid">
          <button class="preview-button" id="preview-button">Button</button>
          <span class="preview-link" id="preview-link">Link Text</span>
          <input type="text" class="preview-input" id="preview-input" value="Input Field">
        </div>
      </div>

      <!-- Recent Colors -->
      <div class="recent-colors">
        <div class="recent-title">Recent Color Combinations</div>
        <div class="recent-list" id="recent-list">
          <span class="recent-empty">No recent colors yet</span>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Theme handling
    function getSystemTheme() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    function getStoredTheme() {
      return localStorage.getItem('wbtl-theme');
    }

    function setTheme(theme) {
      if (theme === 'system') {
        document.documentElement.removeAttribute('data-theme');
        localStorage.removeItem('wbtl-theme');
      } else {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('wbtl-theme', theme);
      }
    }

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const system = getSystemTheme();

      if (!current) {
        setTheme(system === 'dark' ? 'light' : 'dark');
      } else {
        if (current === system) {
          setTheme(current === 'dark' ? 'light' : 'dark');
        } else {
          setTheme('system');
        }
      }
    }

    (function() {
      const stored = getStoredTheme();
      if (stored) {
        setTheme(stored);
      }
    })();

    document.querySelector('.toggle-switch').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleTheme();
      }
    });

    // Color parsing utilities
    function parseColor(color) {
      color = color.trim();

      // HEX
      if (color.startsWith('#')) {
        return hexToRgb(color);
      }

      // RGB/RGBA
      const rgbMatch = color.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
      if (rgbMatch) {
        return {
          r: parseInt(rgbMatch[1]),
          g: parseInt(rgbMatch[2]),
          b: parseInt(rgbMatch[3])
        };
      }

      // HSL/HSLA
      const hslMatch = color.match(/hsla?\s*\(\s*(\d+)\s*,\s*(\d+)%?\s*,\s*(\d+)%?/i);
      if (hslMatch) {
        return hslToRgb(
          parseInt(hslMatch[1]),
          parseInt(hslMatch[2]),
          parseInt(hslMatch[3])
        );
      }

      // Named colors - use canvas trick
      const ctx = document.createElement('canvas').getContext('2d');
      ctx.fillStyle = color;
      const computed = ctx.fillStyle;
      if (computed.startsWith('#')) {
        return hexToRgb(computed);
      }

      return null;
    }

    function hexToRgb(hex) {
      hex = hex.replace('#', '');
      if (hex.length === 3) {
        hex = hex.split('').map(c => c + c).join('');
      }
      const num = parseInt(hex, 16);
      return {
        r: (num >> 16) & 255,
        g: (num >> 8) & 255,
        b: num & 255
      };
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => {
        const hex = Math.round(Math.max(0, Math.min(255, x))).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }).join('');
    }

    function hslToRgb(h, s, l) {
      s /= 100;
      l /= 100;
      const a = s * Math.min(l, 1 - l);
      const f = n => {
        const k = (n + h / 30) % 12;
        return l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
      };
      return {
        r: Math.round(f(0) * 255),
        g: Math.round(f(8) * 255),
        b: Math.round(f(4) * 255)
      };
    }

    function rgbToHsl(r, g, b) {
      r /= 255;
      g /= 255;
      b /= 255;
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }

      return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        l: Math.round(l * 100)
      };
    }

    // WCAG Contrast Calculation
    function getLuminance(r, g, b) {
      const [rs, gs, bs] = [r, g, b].map(c => {
        c = c / 255;
        return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
    }

    function getContrastRatio(rgb1, rgb2) {
      const l1 = getLuminance(rgb1.r, rgb1.g, rgb1.b);
      const l2 = getLuminance(rgb2.r, rgb2.g, rgb2.b);
      const lighter = Math.max(l1, l2);
      const darker = Math.min(l1, l2);
      return (lighter + 0.05) / (darker + 0.05);
    }

    // DOM Elements
    const fgPicker = document.getElementById('fg-picker');
    const bgPicker = document.getElementById('bg-picker');
    const fgInput = document.getElementById('foreground');
    const bgInput = document.getElementById('background');
    const mainPreview = document.getElementById('main-preview');
    const ratioValue = document.getElementById('ratio-value');
    const suggestionsPanel = document.getElementById('suggestions-panel');
    const suggestionList = document.getElementById('suggestion-list');
    const componentPreview = document.getElementById('component-preview');
    const previewButton = document.getElementById('preview-button');
    const previewLink = document.getElementById('preview-link');
    const previewInput = document.getElementById('preview-input');
    const recentList = document.getElementById('recent-list');

    const badges = {
      aaNormal: document.getElementById('aa-normal-badge'),
      aaLarge: document.getElementById('aa-large-badge'),
      aaaNormal: document.getElementById('aaa-normal-badge'),
      aaaLarge: document.getElementById('aaa-large-badge')
    };

    const checkIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`;
    const xIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`;

    // Update badge
    function updateBadge(badge, pass) {
      badge.className = 'wcag-badge ' + (pass ? 'pass' : 'fail');
      badge.innerHTML = (pass ? checkIcon : xIcon) + (pass ? ' Pass' : ' Fail');
    }

    // Generate suggestions
    function generateSuggestions(fgRgb, bgRgb, targetRatio) {
      const suggestions = [];
      const fgHsl = rgbToHsl(fgRgb.r, fgRgb.g, fgRgb.b);
      const bgHsl = rgbToHsl(bgRgb.r, bgRgb.g, bgRgb.b);

      // Try adjusting foreground lightness
      for (let delta = 5; delta <= 50; delta += 5) {
        // Darker foreground
        const darkerL = Math.max(0, fgHsl.l - delta);
        const darkerRgb = hslToRgb(fgHsl.h, fgHsl.s, darkerL);
        const darkerRatio = getContrastRatio(darkerRgb, bgRgb);
        if (darkerRatio >= targetRatio) {
          suggestions.push({
            type: 'foreground',
            label: 'Darker foreground',
            color: rgbToHex(darkerRgb.r, darkerRgb.g, darkerRgb.b),
            ratio: darkerRatio
          });
          break;
        }
      }

      for (let delta = 5; delta <= 50; delta += 5) {
        // Lighter foreground
        const lighterL = Math.min(100, fgHsl.l + delta);
        const lighterRgb = hslToRgb(fgHsl.h, fgHsl.s, lighterL);
        const lighterRatio = getContrastRatio(lighterRgb, bgRgb);
        if (lighterRatio >= targetRatio) {
          suggestions.push({
            type: 'foreground',
            label: 'Lighter foreground',
            color: rgbToHex(lighterRgb.r, lighterRgb.g, lighterRgb.b),
            ratio: lighterRatio
          });
          break;
        }
      }

      // Try adjusting background lightness
      for (let delta = 5; delta <= 50; delta += 5) {
        // Darker background
        const darkerL = Math.max(0, bgHsl.l - delta);
        const darkerRgb = hslToRgb(bgHsl.h, bgHsl.s, darkerL);
        const darkerRatio = getContrastRatio(fgRgb, darkerRgb);
        if (darkerRatio >= targetRatio) {
          suggestions.push({
            type: 'background',
            label: 'Darker background',
            color: rgbToHex(darkerRgb.r, darkerRgb.g, darkerRgb.b),
            ratio: darkerRatio
          });
          break;
        }
      }

      for (let delta = 5; delta <= 50; delta += 5) {
        // Lighter background
        const lighterL = Math.min(100, bgHsl.l + delta);
        const lighterRgb = hslToRgb(bgHsl.h, bgHsl.s, lighterL);
        const lighterRatio = getContrastRatio(fgRgb, lighterRgb);
        if (lighterRatio >= targetRatio) {
          suggestions.push({
            type: 'background',
            label: 'Lighter background',
            color: rgbToHex(lighterRgb.r, lighterRgb.g, lighterRgb.b),
            ratio: lighterRatio
          });
          break;
        }
      }

      return suggestions;
    }

    // Apply suggestion
    function applySuggestion(type, color) {
      if (type === 'foreground') {
        fgInput.value = color;
        fgPicker.value = color;
      } else {
        bgInput.value = color;
        bgPicker.value = color;
      }
      updateContrast();
    }

    // Main update function
    function updateContrast() {
      const fgColor = fgInput.value;
      const bgColor = bgInput.value;

      const fgRgb = parseColor(fgColor);
      const bgRgb = parseColor(bgColor);

      if (!fgRgb || !bgRgb) {
        ratioValue.textContent = '--:--';
        return;
      }

      // Update color pickers if inputs are valid hex
      if (fgColor.match(/^#[0-9a-f]{6}$/i)) {
        fgPicker.value = fgColor;
      }
      if (bgColor.match(/^#[0-9a-f]{6}$/i)) {
        bgPicker.value = bgColor;
      }

      const ratio = getContrastRatio(fgRgb, bgRgb);
      const ratioRounded = Math.round(ratio * 100) / 100;
      ratioValue.textContent = ratioRounded.toFixed(2) + ':1';

      // Update preview
      const fgHex = rgbToHex(fgRgb.r, fgRgb.g, fgRgb.b);
      const bgHex = rgbToHex(bgRgb.r, bgRgb.g, bgRgb.b);

      mainPreview.style.backgroundColor = bgHex;
      mainPreview.style.color = fgHex;

      // Update component preview
      componentPreview.style.backgroundColor = bgHex;
      previewButton.style.backgroundColor = fgHex;
      previewButton.style.color = bgHex;
      previewLink.style.color = fgHex;
      previewInput.style.borderColor = fgHex;
      previewInput.style.color = fgHex;
      previewInput.style.backgroundColor = bgHex;

      // Update WCAG badges
      const passAaNormal = ratio >= 4.5;
      const passAaLarge = ratio >= 3;
      const passAaaNormal = ratio >= 7;
      const passAaaLarge = ratio >= 4.5;

      updateBadge(badges.aaNormal, passAaNormal);
      updateBadge(badges.aaLarge, passAaLarge);
      updateBadge(badges.aaaNormal, passAaaNormal);
      updateBadge(badges.aaaLarge, passAaaLarge);

      // Show suggestions if failing AA normal text
      if (!passAaNormal) {
        const suggestions = generateSuggestions(fgRgb, bgRgb, 4.5);
        if (suggestions.length > 0) {
          suggestionList.innerHTML = suggestions.map(s => `
            <div class="suggestion-item" onclick="applySuggestion('${s.type}', '${s.color}')">
              <div class="suggestion-swatch" style="background: ${s.color}"></div>
              <div>
                <div class="suggestion-text">${s.color}</div>
                <div class="suggestion-ratio">${s.label} (${s.ratio.toFixed(2)}:1)</div>
              </div>
            </div>
          `).join('');
          suggestionsPanel.classList.add('visible');
        } else {
          suggestionsPanel.classList.remove('visible');
        }
      } else {
        suggestionsPanel.classList.remove('visible');
      }

      // Save to recent (debounced)
      saveToRecent(fgHex, bgHex, ratioRounded);
    }

    // Recent colors storage
    let recentSaveTimeout;
    function saveToRecent(fg, bg, ratio) {
      clearTimeout(recentSaveTimeout);
      recentSaveTimeout = setTimeout(() => {
        let recent = JSON.parse(localStorage.getItem('contrast-recent') || '[]');
        const key = `${fg}-${bg}`;

        // Remove duplicate if exists
        recent = recent.filter(r => `${r.fg}-${r.bg}` !== key);

        // Add new entry at beginning
        recent.unshift({ fg, bg, ratio });

        // Keep only last 10
        recent = recent.slice(0, 10);

        localStorage.setItem('contrast-recent', JSON.stringify(recent));
        renderRecent();
      }, 500);
    }

    function renderRecent() {
      const recent = JSON.parse(localStorage.getItem('contrast-recent') || '[]');

      if (recent.length === 0) {
        recentList.innerHTML = '<span class="recent-empty">No recent colors yet</span>';
        return;
      }

      recentList.innerHTML = recent.map(r => `
        <div class="recent-item" onclick="loadRecent('${r.fg}', '${r.bg}')">
          <div class="recent-swatch" style="background: linear-gradient(135deg, ${r.fg} 50%, ${r.bg} 50%)"></div>
          <span>${r.ratio}:1</span>
        </div>
      `).join('');
    }

    function loadRecent(fg, bg) {
      fgInput.value = fg;
      bgInput.value = bg;
      fgPicker.value = fg;
      bgPicker.value = bg;
      updateContrast();
    }

    // Swap colors
    function swapColors() {
      const temp = fgInput.value;
      fgInput.value = bgInput.value;
      bgInput.value = temp;
      fgPicker.value = fgInput.value;
      bgPicker.value = bgInput.value;
      updateContrast();
    }

    // Event listeners
    fgInput.addEventListener('input', updateContrast);
    bgInput.addEventListener('input', updateContrast);

    fgPicker.addEventListener('input', () => {
      fgInput.value = fgPicker.value.toUpperCase();
      updateContrast();
    });

    bgPicker.addEventListener('input', () => {
      bgInput.value = bgPicker.value.toUpperCase();
      updateContrast();
    });

    // Initialize
    renderRecent();
    updateContrast();
  </script>
</body>
</html>
